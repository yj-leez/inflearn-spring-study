# 스프링 입문

### 스프링 웹 개발 기초

- 정적 컨텐츠
    
    스프링 컨테이너에 해당 컨트롤러가 없을 때 파일을 그냥 웹브라우저에 내려줌
    <img width="644" alt="1" src="https://github.com/yj-leez/inflearn_spring_study/assets/77960090/b431f404-5e76-46a2-b34f-9cce30f5a4bb">

    
    
- MVC와 템플릿 엔진
    
    MVC: Model, View, Controller
    
    - Controller: 비즈니스 로직, 내부적인 것 처리, 모델을 만들어 view에게 전달, @Controller사용
        
        @GetMapping 괄호 안에 들어있는 값이 들어오면 해당 함수 실행 후 리턴 값.html 파일을 찾아 실행
        
        @PostMapping 괄호 안에 들어있는 값이 들어오면
        
    - View: 처리 결과를 사용자에게 보여주는 화면
    - Model: View에서 표현할 데이터를 저장하는 객체
    - Controller에서 데이터를 가공하고, 이를 View에 넘겨 페이지에 표시한다. Controller에서 View로 데이터를 넘기는 방법에서 model이 쓰인다. model 객체를 파라미터로 받아 데이터를 넘긴다. hashMap 형태로, 데이터를 넘긴다. hashMap 형태로, 데이터를 key-value 꼴로 put해준다. (addAttribute)
- API
    
    컨트롤러가 반환하는 데이터를 HTTP Response Body에 직접 쓰도록 지정하는 어노테이션
    
    @ResponseBody를 사용하고, 객체를 반환하면 객체가 JSON으로 변환되어 직접 반환됨
    

### 회원 관리 예제 - 백엔드 개발

<img width="847" alt="2" src="https://github.com/yj-leez/inflearn_spring_study/assets/77960090/20a3a884-7789-4171-ad18-cc792fd4b72b">


<img width="847" alt="3" src="https://github.com/yj-leez/inflearn_spring_study/assets/77960090/176f4bc6-dc64-4d0a-940d-f4793c271ba3">


- 회원 객체
- 회원 리포지토리 인터페이스
- 회원 리포지토리 메모리 구현체
- 회원 서비스

### 회원 리포지토리, 서비스 테스트 케이스 작성

- @Test 어노테이션은 테스트 코드를 작성할 때 사용
- given, when, then의 순서를 따라 작성하면 좋다.
- @AfterEach: 각 테스트가 종료될 때 마다 실행, 예를 들어 DB에 직전 테스트 결과가 남지 않도록 할 때 사용할 수 있다.
    
    ```java
    @AfterEach
        public void afterEach() {
            repository.clearStore();
        }
    ```
    
- @BeforeEach: 각 테스트 실행 전에 호출, 테스트가 서로 영향이 없도록 항상 새로운 객체 생성하고 새로운 의존관계를 맺어줌
- 참고
    
    throws: 매서드를 호출한 곳으로 예외를 떠넘기는 키워드
    

### 스프링 빈과 의존관계

- 컴포넌트 스캔과 자동 의존관계 설정
    - 컴포넌트 스캔 원리
        
        @Component 또는 @Component를 포함하는 애노테이션(@Controller, @Service, @Repository)이 있으면 스프링 빈으로 자동 등록됨
        
    - 자동 의존관계 설정
        
        DI(Dependency Injection): 객체 의존관계를 외부에서 넣어주는 것
        
        회원 컨트롤러가 회원 서비스와 회원 리포지토리를 사용할 수 있게끔 의존관계를 주입해야함
        
        생성자에 @Autowired가 있으면 객체 생성 시점에 스프링이 연관된 객체를 스프링 컨테이너에서 찾아서 넣어줌. 생성자가 1개만 있으면 @Autowired 생략 가능.
        
- 자바 코드로 직접 스프링 빈 등록하기
    
    컴포넌트 애노테이션을 제거하고 진행
    
    ```java
    package hello.hellospring;
        import hello.hellospring.repository.MemberRepository;
        import hello.hellospring.repository.MemoryMemberRepository;
        import hello.hellospring.service.MemberService;
        import org.springframework.context.annotation.Bean;
        import org.springframework.context.annotation.Configuration;
        @Configuration
        public class SpringConfig {
      
             @Bean
            public MemberService memberService() {
                return new MemberService(memberRepository());
            }
            @Bean
            public MemberRepository memberRepository() {
              return new MemoryMemberRepository();
            }
    }
    ```
    
    상황에 따라 구현 클래스를 변경해야 할 때 자바 코드로 설정하는 것이 편리
    
    <aside>
    💡 스프링은 스프링 컨테이너에 스프링 빈을 등록할 때, 기본으로 싱글톤으로 등록한다. 따라서 같은 스프링 빈이면 모두 같은 인스턴스이다.
    
    </aside>
    

### 회원 관리 예제 - 웹 MVC 개발

회원 웹 기능 - 홈 화면 추가

- 홈 컨트롤러 추가
- 회원 관리용 홈 HTML

회원 웹 기능 - 등록

- 회원 등록 폼 컨트롤러
- 회원 등록 폼 HTML
- 웹 등록 화면에서 데이터를 전달 받을 폼 객체
    
    <aside>
    💡 Q. Member 대신 MemberForm을 사용하는 이유
    A. 실무에서는 컨트롤러에 넘어오는 정보가 Member가 필요한 데이터 이상으로 많은 데이터들이 들어옵니다. 예를 들어 회원 정보 뿐만 아니라 약관 정보도 들어오고, 화면을 처리하기 위한 추가 정보들도 들어옵니다. 더 여러가지가 있지만, 주로 이런 이유로 MemberForm과 Member를 분리하는 것이 좋습니다
    Q. MemberForm은 순수 자바 코드인데 어떻게 setName을 할 수 있는지 궁금
    A. 스프링 MVC가 기본으로 지원하는 기능입니다. 웹의 파라미터에 name이라는 이름이 있으면 이 이름을 보고 스프링 MVC가 setName을 호출합니다.
    
    </aside>
    
- 회원 컨트롤러에서 회원을 실제 등록하는 기능

회원 웹 기능 - 조회

- 회원 컨트롤러에서 조회 기능
- 회원 리스트 HTML

### 스프링 DB 접근 기술

- h2 데이터베이스 파일 생성 방법
    - 해당 파일 안에 들어간 후 `chmod 755 [h2.sh](http://h2.sh)` 로 권한 주기
    - 실행: `./h2.sh`
    - `jdbc:h2:~/test`(최초 한번)
    - ~/test.mv.db 파일 생성 확인
    - 이후부터는 `jdbc:h2:tcp://localhost/~/test` 이렇게 접속
- 테이블 생성하기
    
    ```sql
    drop table if exists member CASCADE;
        create table member
        (
            id   bigint generated by default as identity,
            name varchar(255),
            primary key (id)
    );
    ```
    
- JPA
    - build.grandle 파일에 JPA, h2 데이터베이스 관련 라이브러리 추가
        
        ```java
        dependencies {
            implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
            implementation 'org.springframework.boot:spring-boot-starter-web'
        //implementation 'org.springframework.boot:spring-boot-starter-jdbc' 
        implementation 'org.springframework.boot:spring-boot-starter-data-jpa' 
        runtimeOnly 'com.h2database:h2' 
        testImplementation('org.springframework.boot:spring-boot-starter-test') {
                exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
            }
        }
        ```
        
    - application.properties에 JPA 설정 추가
    - JPA 엔티티 매핑: @Entity, @Id, @GeneratedValue, @Column 등등
    - JPA 회원 리포지토리: EntityManger 활용
    - 서비스계층에 트랜잭션 추가
- 테스트케이스 작성
    - @SpringBootTest: 스프링 컨테이너와 테스트를 함께 실행한다
    - @Transactional: 테스트 케이스에 이 애노테이션이 있으면, 테스트 시작 전에 트랜잭션을 시작하고, 테스트 완료 후에 항상 롤백한다. 이렇게 하면 DB에 데이터가 남지 않으므로 다음 테스트에 영향을 주지 않는다.
